import asyncio
import logging
import random
from os import getenv
from dotenv import load_dotenv

from aiogram import Bot, Dispatcher, types
from aiogram.filters import CommandStart, Command
from aiogram.types import Message

load_dotenv()
TOKEN = getenv("BOT_TOKEN")
if not TOKEN:
    raise ValueError("BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Heroku")

logging.basicConfig(level=logging.INFO)
bot = Bot(token=TOKEN)
dp = Dispatcher()

# ----------------- –ì–ï–ù–ï–†–ê–¢–û–† –¢–†–û–õ–õ–ò–ù–ì–ê -----------------
status = [
    "—Ç–µ—Ä–ø–∏–ª–æ–π–¥–Ω—ã–π", "–∫–∞—à–æ–ª–∫ –µ–±–∞–Ω—ã–π", "–≤–∞—Ñ–ª—è–∂—ë—Ä", "—Å—ã–Ω —à–∞–ª–∞–≤—ã", "–ø–∏–¥–æ—Ä–∞—Å –æ—Ç—Å–æ—Å–∞–≤—à–∏–π",
    "–Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥ –º–æ–∏–º —Ö—É–µ–º", "–∂–∏—Ä–æ–±–∞—Å–Ω—ã–π —Ü–∏–∫–ª–æ–±", "–∏–º–±–µ—Ü–∏–ª—å–Ω—ã–π –æ—á–∫–æ—Å–æ—Å",
    "—Å–ª–∞–±–∞–∫ —Å –∑–∞–ª—É–ø–æ–π –≤ –∂–æ–ø–µ", "—ç–∫—Å–ø–æ–Ω–∞—Ç –º–æ–µ–≥–æ –∞—Ä–∏–≥–∞—Ç–∞", "–≥–Ω–∏–ª–æ–µ –≥–æ–≤–Ω–æ"
]

threats = [
    "–æ—Ç—Å–æ—Å–∏ –º–æ–π —Ö—É–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Å—É–∫–∞",
    "–±–µ—Ä–∏ –≤ —Ä–æ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏–ª–∏ —Ä–∞–∑—ä–µ–±—É —Ä—ã–ª–∏—â–µ —Ç–≤–æ–µ–π –º—ë—Ä—Ç–≤–æ–π –º–∞—Ç–µ—Ä–∏",
    "–º–∞–º–∞—à—É —Ç–≤–æ—é –Ω–∞ —à–∞—à–ª—ã–∫–∏ –ø–æ—Ä–µ–∂—É –∏ —Ç–µ–±–µ —Å–∫–æ—Ä–º–ª—é",
    "—Ç–≤–æ—ë –º–µ—Ä—Ç–≤–æ–µ –æ—á–∫–æ –ø–æ–ª–≥–æ—Ä–æ–¥–∞ –µ–±–∞–ª–æ ‚Äî —Å–µ–π—á–∞—Å –ø—Ä–æ–¥–æ–ª–∂—É",
    "—Å–µ–º–µ–π–∫—É –≥–Ω–∏–ª–æ–∑—É–±—É—é –∑–∞—Å—Ç–∞–≤–ª—é –∂—Ä–∞—Ç—å —Ç–≤–æ–∏ –æ—Ç–æ—Ä–≤–∞–Ω–Ω—ã–µ –Ω–æ–≥–∏",
    "–ø–µ–Ω–∏—Å–æ–º —è–∑—ã–∫ —Ç–µ–±–µ –µ–±–∞—à–∏—Ç—å –±—É–¥—É –ø–æ–∫–∞ –Ω–µ –∑–∞—Ö–ª–µ–±–Ω—ë—à—å—Å—è",
    "–∫–∏—Å–ª–æ—Ç–æ–π –∑–∞–ª—å—é —Ç–≤–æ—ë –º–µ–ª–∫–æ–µ —Ç–µ–ª—å—Ü–µ –¥–æ –∫–æ—Å—Ç–µ–π",
    "–º—É—Ç–∞–Ω—Ç–æ–≤ –ø—Ä–∏–∑–æ–≤—É ‚Äî –±—É–¥—É—Ç —Ö—É—è–º–∏ –¥—É—à–∏—Ç—å —Ç–µ–±—è –¥–æ —É—Ç—Ä–∞",
    "—Ä–µ–±—Ä–∞ —Ä–∞–∑–¥—Ä–æ–±–ª—é –∫–∞–∫ —à–∞—à–ª—ã–∫ –∏ —Å–∫–æ—Ä–º–ª—é —Ç–≤–æ–µ–π –º–∞–º–∞—à–µ"
]

ultimatum = [
    "–ø–æ–ø—Ä–æ–±—É–π —Ç–æ–ª—å–∫–æ —Å—ä–µ–±–∞—Ç—å—Å—è ‚Äî –ø–æ–¥—Ä—É–±–ª—é —Ä–µ–∂–∏–º –≥–µ–Ω–æ—Ü–∏–¥–∞",
    "—Å–±–µ–∂–∏—à—å ‚Äî –±—É–¥—É –µ–±–∞—à–∏—Ç—å –ø–æ–∫–∞ –Ω–µ –≤—ã–ª–∏–∂–µ—à—å –∫–∞–∂–¥—ã–π —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä –º–æ–µ–≥–æ —Ö—É—è",
    "—Ç—ã —Å–≥—É—Å—Ç–æ–∫ –≥–æ–≤–Ω–∞, –≤—Å—è —Å–∏–ª–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –º–æ–µ–º—É –≤–µ–ª–∏–∫–æ–º—É —á–ª–µ–Ω—É",
    "–Ω–µ –ø–æ–Ω—Ä–∞–≤—è—Ç—Å—è —ç–º–æ—Ü–∏–∏ ‚Äî –ø—Ä–æ–¥–æ–ª–∂—É –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Ä–∞—Å–ø–∞–¥–∞ —Ç–≤–æ–µ–≥–æ –µ–±–ª–∏—â–∞",
    "–ø–æ–ø—Ä–æ—Å–∏ –ø—Ä–æ—â–µ–Ω–∏—è —É –º–æ–µ–≥–æ —Ö—É—è –∏–ª–∏ —Å–¥–æ—Ö–Ω–µ—à—å —Å—Ä–µ–¥–∏ –º—É—Ç–∞–Ω—Ç–æ–≤"
]

def generate_troll(nick: str = None) -> str:
    victim = nick or random.choice(["—Ç—ã", "—Ç–≤–æ—ë –µ–±–ª–∏—â–µ", "@" + random.choice(["pidor", "suka", "terpila", "govnoed"])])

    parts = [
        f"–≠–π {victim}, {random.choice(status)}!",
        random.choice(threats).upper(),
        f"–¢—ã –Ω–∞—Å—Ç–æ–ª—å–∫–æ {random.choice(['—Ç—É–ø–æ–π', '—Å–ª–∞–±—ã–π', '–Ω–∏–∫—á—ë–º–Ω—ã–π', '–¥–µ—Ñ–µ–∫—Ç–Ω—ã–π'])} —á—Ç–æ –¥–∞–∂–µ –º–æ–∏ –ª—ë–≥–∫–∏–µ —Ö–∞—Ä—á–∏ —Ç–µ–±—è —É–±—å—é—Ç.",
        random.choice(threats),
        random.choice(ultimatum)
    ]
    random.shuffle(parts)  # –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Ä–∞–∑–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ ‚Äî –µ—â—ë –µ–±–∞–Ω—É—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç
    return " ".join(parts) + " üòàüçÜüíÄ"

# ----------------- –•–ï–ù–î–õ–ï–†–´ -----------------

@dp.message(CommandStart())
async def start(message: Message):
    await message.answer(
        "–ô–æ–±–∞–Ω—ã–π –≤ —Ä–æ—Ç –ø—Ä–∏–≤–µ—Ç, —Ç–µ—Ä–ø–∏–ª–∞.\n"
        "–ü–∏—à–∏ /troll ‚Äî –ø–æ–ª—É—á–∏—à—å –ø–∏–∑–¥–µ—Ü –≤ –ª–∏—Ü–æ\n"
        "–ò–ª–∏ /troll @–Ω–∏–∫ ‚Äî –∑–∞—Ç—Ä–æ–ª–ª—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –µ–≥–æ"
    )

@dp.message(Command("troll"))
async def troll_cmd(message: Message):
    args = message.text.split(maxsplit=1)
    target = None
    if len(args) > 1 and args[1].startswith("@"):
        target = args[1]

    text = generate_troll(target)
    await message.reply(text)

@dp.message()
async def auto_troll(message: Message):
    # –∞–≤—Ç–æ-—Ç—Ä–æ–ª–ª–∏–Ω–≥ –Ω–∞ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–º–æ–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ç—å)
    if random.random() < 0.4:  # \~40% —à–∞–Ω—Å –æ—Ç–≤–µ—Ç–∏—Ç—å
        text = generate_troll()
        await message.reply(text)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main()) 
